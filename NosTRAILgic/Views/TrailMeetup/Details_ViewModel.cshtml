@model IEnumerable<NosTRAILgic.Models.TrailMeetup_Details_ViewModel>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="~/Scripts/trailmeetup-details_viewmodel.js"></script>

@{
    ViewBag.Title = "Details";
}

<table width="100%" border="1">
    <tr>
        @foreach (var item in Model)
        {
            <td width="10%">                                                                   
                <img src="/Content/Upload/@Url.Content(item.getTrailMeetup.ImageLink)" width="100" height="100" />
            </td>

            <td width="40%">
                <h2>Trail Details - @Html.DisplayFor(model => item.getTrailMeetup.Name)</h2>

                <br />

                <b>@Html.DisplayNameFor(model => model.getTrailMeetup.CreatorID) : </b>
                    @Html.DisplayFor(model => item.getTrailMeetup.CreatorID)

                <br />

                <b>@Html.DisplayNameFor(model => model.getTrailMeetup.Description) : </b>
                    @Html.DisplayFor(model => item.getTrailMeetup.Description)
            </td>

            <td width="50%">
                @{
                    if (item.getUserinTrailMeetup == "" || item.getUserinTrailMeetup == null)
                    {
                        if (item.getNumberOfUsersInTrailMeetup < item.getTrailMeetup.Limit)
                        {
                            @Html.ActionLink("Join Trail", "JoinTrail", new { id = item.getTrailMeetup.TrailMeetupID }, new { @class = "btn btn-default" })
                        }
                        else {
                            <button class="btn btn-default" type="button" disabled>Full</button>
                        }
                    }
                    else
                    {
                        if (User.Identity.Name == item.getTrailMeetup.CreatorID)
                        {
                            <button class="btn btn-default" type="button" disabled>Joined</button>
                        }
                        else
                        {
                            @Html.ActionLink("Leave Trail", "LeaveTrail", new { id = item.getTrailMeetup.TrailMeetupID }, new { @class = "btn btn-default" })
                        }
                    }

                }
                
                <br />

                <b>@Html.DisplayNameFor(model => model.getTrailMeetup.Date) : </b>
                    @Html.DisplayFor(model => item.getTrailMeetup.Date)

                <br />

                <b>Time : </b> @Html.DisplayFor(model => item.getTrailMeetup.TimeFrom)
                <b> - </b> @Html.DisplayFor(model => item.getTrailMeetup.TimeTo)

                <br />

                <b>@Html.DisplayNameFor(model => model.getTrailMeetup.Limit) : </b>
                    @Html.DisplayFor(model => item.getNumberOfUsersInTrailMeetup) / @Html.DisplayFor(model => item.getTrailMeetup.Limit)
            </td>
        }
    </tr>

    <tr>
        <td colspan="3"><div id="map_canvas" style="width: 100%; height: 300px;"></div></td>
    </tr>

    <tr>
        <td colspan="2">
            <b>Participants :</b>
        </td>

        <td>
            <b>Location Details : </b>
        </td>
    </tr>

    <tr>
        <td colspan="2" valign="top">
            <ul>
                <!-----------------------------------------------------------------------------------
                - Description: For the displaying who are participants of Trails                    -
                -                                                                                   -
                - Developer: Yun Yong                                                               -
                -                                                                                   -
                - Date: 21/03/2016                                                                  -
                ------------------------------------------------------------------------------------->
                @{
                    foreach (var item in Model)
                    {
                        foreach (var trailParticipants in item.enumerableTrailParticipants)
                        {
                            <li>@trailParticipants</li>
                        }
                    }
                }
            </ul>
        </td>

        <td>
            <div id="locationDetails"></div>  
        </td>
    </tr>
</table>

<!-- Passing to JS -->
<p hidden id="detailsViewModelData">@Html.Raw(ViewBag.detailsViewModelJSON)</p>

<p>
    <!-----------------------------------------------------------------------------------
    - Description: Logic for showing the Edit and Delete Trail Button to users          -
    -              Only the Trail Creator can edit the Trail information                -
    -              Only the Trail Creator and the Site Admin can delete Trail           -
    -                                                                                   -
    - Developer: Yun Yong                                                               -
    -                                                                                   -
    - Date: 21/03/2016                                                                  -
    ------------------------------------------------------------------------------------->
    @{
        foreach (var item in Model)
        {
            if (User.Identity.Name == item.getTrailMeetup.CreatorID)
            {
                @Html.ActionLink("Edit", "Edit", new { id = item.getTrailMeetup.TrailMeetupID }, new { @class = "btn btn-default" })
            }
            if (User.IsInRole("Admin") || User.Identity.Name == item.getTrailMeetup.CreatorID)
            {
                @Html.ActionLink("Delete", "Delete", new { id = item.getTrailMeetup.TrailMeetupID }, new { @class = "btn btn-default" })
            }
        }
    }

    <button class="btn btn-default" type="button" onclick="location.href='@Url.Action("Index", "TrailMeetup")'">Back to Trail Index</button>
</p>



