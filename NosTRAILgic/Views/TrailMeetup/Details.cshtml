@model NosTRAILgic.Models.TrailMeetup

@{
    ViewBag.Title = "Details";
}

<div>
    <h2>Trail Details - @Html.DisplayFor(model => model.Name)</h2>
</div>

<div>
    @Html.ActionLink("Join Trail", "JoinTrail", new { id = Model.TrailMeetupID }, new { @class = "btn btn-default" })
</div>

<div>
    <hr />
    
    <div id="map_canvas" style="width: 1000px; height: 300px;"></div>

    <hr />

    <table>
        <tr>
            <td width="25%"><b>@Html.DisplayNameFor(model => model.CreatorID)</b></td>
            <td width="25%">@Html.DisplayFor(model => model.CreatorID)</td>
            <td width="25%"><b>Participants</b></td>
        </tr>

        <tr>
            <td><b>@Html.DisplayNameFor(model => model.Name)</b></td>
            <td>@Html.DisplayFor(model => model.Name)</td>
            <td rowspan="7">@{

                @*@Html.Raw(ViewBag.participants)*@

            string necro = ViewBag.participants;

            string[] necroArray = necro.Split(',');

            foreach (string z in necroArray)
            {
                if (z.EndsWith(","))
                {
                    z.Substring(0, z.Length - 2);
                }

                    @Html.Raw("<p>" + z + "</p>");
                }
                } </td>
        </tr>

        <tr>
            <td><b>@Html.DisplayNameFor(model => model.Description)</b></td>
            <td>@Html.DisplayFor(model => model.Description)</td>
        </tr>

        @*<tr>
            <td><b>@Html.DisplayNameFor(model => model.Location)</b></td>
            <td>@Html.DisplayFor(model => model.Location)</td>
            <td></td>
        </tr>*@

        <tr>
            <td><b>@Html.DisplayNameFor(model => model.ImageLink)</b></td>
            <td>@Html.DisplayFor(model => model.ImageLink)</td>
        </tr>

        <tr>
            <td><b>@Html.DisplayNameFor(model => model.Date)</b></td>
            <td>@Html.DisplayFor(model => model.Date)</td>
        </tr>

        <tr>
            <td><b>@Html.DisplayNameFor(model => model.TimeFrom)</b></td>
            <td>@Html.DisplayFor(model => model.TimeFrom)</td>
        </tr>

        <tr>
            <td><b>@Html.DisplayNameFor(model => model.TimeTo)</b></td>
            <td>@Html.DisplayFor(model => model.TimeTo)</td>
        </tr>

        <tr>
            <td><b>@Html.DisplayNameFor(model => model.Limit)</b></td>
            <td>@Html.DisplayFor(model => model.Limit)</td>
        </tr>

    </table>
    
</div>

<p>
    @{
        if (User.IsInRole("Admin") || User.Identity.Name == Model.CreatorID)
        {
            @Html.ActionLink("Edit", "Edit", new { id = Model.TrailMeetupID }, new { @class = "btn btn-default" })
            @Html.ActionLink("Delete", "Delete", new { id = Model.TrailMeetupID }, new { @class = "btn btn-default" })
        }

    }

    <button class="btn btn-default" type="button" onclick="location.href='@Url.Action("Index", "TrailMeetup")'">Back to Trail Index</button>
</p>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">
    window.onload = initialize;

    function initialize() {

        var mapOptions = {
            center: new google.maps.LatLng(1.4038, 103.7941),
        //    center: new google.maps.LatLng(1.3385674, 103.7059549),
            zoom: 11,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };

        var map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);

        //// create a marker
        //var latlng = new google.maps.LatLng(1.4038, 103.7941);
        //var marker = new google.maps.Marker({
        //    position: latlng,
        //    map: map,
        //    title: 'My Place'
        //});


        var trailInput = '@ViewBag.linqLocationTest';
        var trailLatInput = '@ViewBag.linqLatTest';
        var trailLongInput = '@ViewBag.linqLongTest';

        console.log("Viewbag results for Location: ", trailInput);
        console.log("Viewbag results for Lat: ", trailLatInput);
        console.log("Viewbag results for Long: ", trailLongInput);

        // Split the Trail Input of Location based on COMMA into different location
        var trailArray = trailInput.split(',');
        var latArray = trailLatInput.split(',');
        var longArray = trailLongInput.split(',');

        var markers = [];
        var contents = [];
        var infowindows = [];

        for (i = 0; i < (trailArray.length - 1); i++) {

            console.log("lat long: ", latArray[i] + " , " + longArray[i]);

            markers[i] = new google.maps.Marker({
                position: new google.maps.LatLng(latArray[i], longArray[i]),
                map: map,
                title: 'samplemarker'
            });

            markers[i].index = i;
            contents[i] = '<div class="popup_container">' + trailArray[i] + '</div>';

            infowindows[i] = new google.maps.InfoWindow({
                content: contents[i],
                maxWidth: 300
            });

            google.maps.event.addListener(markers[i], 'click', function () {
                console.log(this.index); // this will give correct index
                console.log(i); //this will always give 10 for you
                infowindows[this.index].open(map, markers[this.index]);
                map.panTo(markers[this.index].getPosition());
            });
        }

    }
</script>