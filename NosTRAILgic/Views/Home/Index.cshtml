@model IEnumerable<NosTRAILgic.Models.Home_ViewModel>

@{
    ViewBag.Title = "Home Page";
}

<div class="container" style="width: 100%">
    <div class="vertical-center-row">
        <div class="page-header">
            <h1>
                Welcome to NosTRAILgic
                <img style="width:50px;" src="~/images/logo.png" />
            </h1>

            @using (Html.BeginForm("index", "Home", FormMethod.Post))
            {

                <span style="float: right;">
                    <i class="glyphicon glyphicon-search"></i>
                    <input id="searchKeyword" type="text" placeholder="Search" />
                    @Html.DropDownList("Selection", new SelectListItem[]
                        {
                            new SelectListItem() { Text = "All", Value = "0" },
                            new SelectListItem() { Text = "Museum", Value = "1" },
                            new SelectListItem() { Text = "Historical Sites", Value = "2" },
                            new SelectListItem() { Text = "Monuments", Value = "3" },
                        },
                            new { @onchange = "this.form.submit()" })
                    <input id="bHomeIndexSearch" type="submit" class="btn btn-default" value="Search"/>
                </span>
            }
        </div>

        <div align="center">
            <div id="map_canvas" style="width: 100%; height: 400px;"></div>

            <div id="locationDetails"></div> 
        </div>
    </div>
</div>


<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>

<script type="text/javascript">
    window.onload = initialize;

    function initialize() {

        var mapOptions = {
            center: new google.maps.LatLng(1.4038, 103.7941),
            //    center: new google.maps.LatLng(1.3385674, 103.7059549),
            zoom: 11,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };

        var map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);

        var markers = [];
        var contents = [];
        var infowindows = [];

        /************************************************************************************
         * Description: This function handles the rendering of the markers to Google        *
         *              map based on the enumerableAllLocationFromTrail object              *
         *                                                                                  *
         * Developer: Yun Yong                                                              *
         *                                                                                  *
         * Date: 21/03/2016                                                                 *
         ************************************************************************************/
        @{
            foreach (var item in Model)
            {
                int counter = 0;
                foreach (var location in item.enumerableAllLocation)
                {
                    <text>
                        markers[@counter] = new google.maps.Marker({
                            position: new google.maps.LatLng(@location.Latitude, @location.Longitude),
                            map: map,
                            title: 'Some Marker Title'
                        });

                        markers[@counter].index = @counter;
                        contents[@counter] = '<div class="popup_container">' + "@location.Name" + '</div>';

                        infowindows[@counter] = new google.maps.InfoWindow({
                                content: contents[@counter] ,
                            maxWidth: 300
                        });

                        google.maps.event.addListener(markers[@counter], 'click', function () {
                            var content =
                            '<div>Name: @location.Name</div>' +
                            '<div>Description: @location.Description</div>' +
                            '<div>Link: <a href="' + '@location.HyperLink' + '">' + '@location.HyperLink' + '</a></div>' +
                            '<div>Image: <img src="' + '@location.ImageLink' + '"/></div>' +
                            '<div>Postal Code: @location.PostalCode</div>' ;

                            document.getElementById("locationDetails").innerHTML = content;

                            infowindows[this.index].open(map, markers[this.index]);
                            map.panTo(markers[this.index].getPosition());
                        });
                    </text>

                    counter++;
                }

            }
        }
    }
</script>

@section Scripts {
    <link rel="stylesheet" href="~/Content/jquery-ui.min.css">
    <script type="text/javascript">
        $(document).ready(function () {
            $('#searchKeyword').autocomplete({
                source: '@Url.Action("GetLocation")'
            });
        });
    </script>
}
